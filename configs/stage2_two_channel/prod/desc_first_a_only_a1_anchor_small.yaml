extends: desc_first_a_only.yaml

# Channel-A only (b_ratio=0), with small A1 (GT-prefix) coord/geo anchors.
#
# Motivation:
# - A1 logits are used to bootstrap A2 self-context embeddings.
# - A weak A1 anchor can reduce self-context drift/noise (esp. in crowded scenes),
#   stabilizing bbox_geo/coord_reg objectives without overpowering A2.

training:
  run_name: epoch_2-eff_size_64-n_softctx_iter_2-a1_anchor_small-
  output_dir: output/stage2_ab/coco_bbox_max60/a_only_a1_anchor_small
  logging_dir: tb/stage2_ab/coco_bbox_max60/a_only_a1_anchor_small

stage2_ab:
  pipeline:
    objective:
      - name: token_ce
        enabled: true
        weight: 1.0
        channels: [A, B]
        config:
          desc_ce_weight: 1.0
          self_context_struct_ce_weight: 0.1
          rollout_fn_desc_weight: 1.0
          rollout_matched_prefix_struct_weight: 1.0
          rollout_drop_invalid_struct_ce_multiplier: 1.0
      - name: bbox_geo
        enabled: true
        weight: 1.0
        channels: [A, B]
        config:
          smoothl1_weight: 2.0
          ciou_weight: 0.2
          a1_smoothl1_weight: 0.2
          a1_ciou_weight: 0.02
      - name: coord_reg
        enabled: true
        weight: 1.0
        channels: [A, B]
        config:
          coord_ce_weight: 0.02
          coord_el1_weight: 0.0
          coord_ehuber_weight: 0.0
          coord_huber_delta: 0.001
          coord_entropy_weight: 0.0
          coord_gate_weight: 1.0
          text_gate_weight: 0.1
          soft_ce_weight: 0.1
          self_context_soft_ce_weight: 0.1
          w1_weight: 0.1
          a1_soft_ce_weight: 0.02
          a1_w1_weight: 0.02
          temperature: 1.0
          target_sigma: 2.0
          target_truncate: 8
    diagnostics:
      - name: coord_diag
        enabled: true
        weight: 1.0
        channels: [A, B]
        config: {}

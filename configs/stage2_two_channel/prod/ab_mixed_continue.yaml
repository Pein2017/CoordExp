extends: ../base.yaml

model:
  model: output/stage2_ab/experimental/ab_mixed_ckpt_400

training:
  run_name: prod_ab_mixed_continue_from_ckpt_400
  output_dir: output/stage2_ab/prod/ab_mixed_continue
  logging_dir: tb/stage2_ab/prod/ab_mixed_continue
  learning_rate: 2.0e-5
  vit_lr: 2.0e-5
  aligner_lr: 5.0e-5
  effective_batch_size: 56
  eval_strategy: steps
  save_strategy: steps
  save_steps: 200
  do_eval: true
  eval_steps: 100

stage2_ab:
  schedule: {b_ratio: 0.85}
  n_softctx_iter: 2
  coord_gate_weight: 1.0
  bbox_ciou_weight: 0.2

custom:
  val_sample_limit: 504
  coord_soft_ce_w1:
    soft_ce_weight: 0.2
    w1_weight: 0.2
  extra:
    prompt_variant: coco_80

rollout_matching:
  max_new_tokens: 3084
  decode_batch_size: 4
  monitor_dump:
    enabled: true
    every_steps: 100
    max_events: 0
    max_samples: 10
    max_text_chars: 0
    write_markdown: false
  rollout_backend: vllm
  vllm:
    mode: server
    server:
      debug_dump:
        enabled: true
        every_steps: 40
        dump_first_step: true
        max_events: 200
        max_samples: 10
        max_chars: 0
